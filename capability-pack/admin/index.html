<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/png" sizes="16x16" href="../../https://raw.githubusercontent.com/ipns-io/ipns-site/main/assets/favicons/favicon_16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../https://raw.githubusercontent.com/ipns-io/ipns-site/main/assets/favicons/favicon_32.png">
<link rel="icon" type="image/png" sizes="64x64" href="../../https://raw.githubusercontent.com/ipns-io/ipns-site/main/assets/favicons/favicon_64.png">
<link rel="apple-touch-icon" href="../../https://raw.githubusercontent.com/ipns-io/ipns-site/main/assets/favicons/final_favicon.png">
<title>admin.ipns.io mock</title>
<link rel="stylesheet" href="../assets/theme.css" />
</head>
<body>
<header class="top">
  <div class="brand">admin.ipns.io</div>
  <span class="badge">ops console mock</span>
</header>
<main class="wrap">
  <section class="hero">
    <h1>Name ops without backend lock-in.</h1>
    <p>Build static operational tooling that prepares deterministic commands and onchain actions.</p>
    <div class="nav-links">
      <a href="../www/index.html">www</a>
      <a href="../docs/index.html">docs</a>
      <a href="../admin/index.html">admin</a>
      <a href="../app/index.html">app</a>
      <a href="../status/index.html">status</a>
    </div>
  </section>

  <section class="grid">
    <article class="card span-4">
      <h3>Registry snapshot</h3>
      <div class="kpis">
        <div class="kpi"><div class="label">contract</div><div class="value" style="font-size:14px;">0x7Bb7...Cc2d</div></div>
        <div class="kpi"><div class="label">network</div><div class="value">base sepolia</div></div>
        <div class="kpi"><div class="label">grace period</div><div class="value">90d</div></div>
        <div class="kpi"><div class="label">status</div><div class="value ok">healthy</div></div>
      </div>
    </article>

    <article class="card span-8">
      <h3>CID update builder</h3>
      <label>Name
        <input id="adminName" value="yourname" />
      </label>
      <label style="margin-top:10px;">New CID
        <textarea id="adminCid" rows="3">bafybeibi4xw34bcyax6xtmdddapz7nmyew5rdhtiuf7kodjj2eq4udco6u</textarea>
      </label>
      <div class="controls" style="margin-top:10px;">
        <button id="buildUpdate">Build command</button>
        <button class="secondary" id="copyUpdate">Copy command</button>
      </div>
      <pre class="code" id="adminCmd" style="margin-top:10px; display:none;"></pre>
      <p class="muted" id="adminOut"></p>
    </article>

    <article class="card span-12">
      <h3>Name ownership (onchain read-only)</h3>
      <p class="muted">API: <code>GET /v1/names/ownership</code> (requires token)</p>
      <label>Token
        <input id="ownershipToken" placeholder="Bearer token" />
      </label>
      <div class="controls" style="margin-top:10px;">
        <button id="refreshOwnership">Refresh ownership</button>
      </div>
      <table class="table" style="margin-top:10px;">
        <tr><th>Name</th><th>Owner</th><th>Active</th><th>CID</th><th>Available</th><th>Reserved</th><th>Last Updated</th></tr>
        <tbody id="ownershipRows">
          <tr><td colspan="7">not loaded</td></tr>
        </tbody>
      </table>
      <pre class="code" id="ownershipMeta" style="margin-top:10px;">// waiting for refresh</pre>
    </article>

    <article class="card span-12">
      <h3>Reserved names (example policy set)</h3>
      <table class="table">
        <tr><th>Name</th><th>Reason</th><th>State</th></tr>
        <tr><td>www</td><td>public landing</td><td class="ok">reserved</td></tr>
        <tr><td>docs</td><td>developer docs</td><td class="ok">reserved</td></tr>
        <tr><td>admin</td><td>ops/admin console</td><td class="ok">reserved</td></tr>
        <tr><td>app</td><td>registration app surface</td><td class="ok">reserved</td></tr>
        <tr><td>status</td><td>network + gateway status</td><td class="ok">reserved</td></tr>
      </table>
    </article>
  </section>

  <p class="footer">admin build timestamp: <span data-now></span></p>
</main>
<script src="../assets/app.js"></script>
<script>
(function () {
  const cmd = document.getElementById('adminCmd');
  const out = document.getElementById('adminOut');
  const tracked = 'app,status,docs,admin,www,scavone,cidrun,g,g2,guy,guy2,guy3,ella,lily,katie,korbyn,joe';

  function render() {
    const name = (document.getElementById('adminName').value || '').trim().toLowerCase();
    const cid = (document.getElementById('adminCid').value || '').trim();
    if (!name || !cid) return '';
    return 'cast send --rpc-url "$RPC_URL" --private-key "$PRIVATE_KEY" "$CONTRACT" "setCID(string,string)" "' + name + '" "' + cid + '"';
  }

  document.getElementById('buildUpdate').addEventListener('click', () => {
    const built = render();
    if (!built) return;
    cmd.style.display = 'block';
    cmd.textContent = built;
    out.innerHTML = '<span class="ok">command generated</span>';
  });

  document.getElementById('copyUpdate').addEventListener('click', async () => {
    const built = render();
    if (!built) return;
    try {
      await navigator.clipboard.writeText(built);
      out.innerHTML = '<span class="ok">command copied</span>';
    } catch (_) {
      out.innerHTML = '<span class="warn">clipboard blocked; copy manually</span>';
    }
  });

  const tokenInput = document.getElementById('ownershipToken');
  const rowsEl = document.getElementById('ownershipRows');
  const metaEl = document.getElementById('ownershipMeta');
  tokenInput.value = localStorage.getItem('confetti_api_token') || '';

  function short(v) {
    if (!v) return '-';
    if (v.length < 14) return v;
    return v.slice(0, 8) + 'â€¦' + v.slice(-6);
  }

  document.getElementById('refreshOwnership').addEventListener('click', async () => {
    const token = tokenInput.value.trim();
    if (token) localStorage.setItem('confetti_api_token', token);
    const headers = token ? { Authorization: 'Bearer ' + token } : {};
    const url = 'https://api.confetti.wtf/v1/names/ownership?names=' + encodeURIComponent(tracked);
    metaEl.textContent = 'loading ' + url;
    try {
      const res = await fetch(url, { headers });
      const txt = await res.text();
      let payload = null;
      try { payload = JSON.parse(txt); } catch {}
      if (!res.ok) {
        rowsEl.innerHTML = '<tr><td colspan="7">error ' + res.status + '</td></tr>';
        metaEl.textContent = txt.slice(0, 800);
        return;
      }
      const names = Array.isArray(payload?.names) ? payload.names : [];
      rowsEl.innerHTML = names.map((r) => '<tr>' +
        '<td>' + r.name + '</td>' +
        '<td>' + short(r.owner) + '</td>' +
        '<td>' + (r.active ? 'yes' : 'no') + '</td>' +
        '<td>' + short(r.cid) + '</td>' +
        '<td>' + (r.available ? 'yes' : 'no') + '</td>' +
        '<td>' + (r.reserved ? 'yes' : 'no') + '</td>' +
        '<td>' + (r.updatedAt || '-') + '</td>' +
        '</tr>').join('');
      metaEl.textContent = JSON.stringify({
        requestId: payload?.requestId || res.headers.get('x-request-id'),
        chainId: payload?.chainId,
        contractAddress: payload?.contractAddress,
        rowCount: names.length
      }, null, 2);
    } catch (err) {
      rowsEl.innerHTML = '<tr><td colspan="7">network error</td></tr>';
      metaEl.textContent = String(err);
    }
  });
})();
</script>
</body>
</html>
